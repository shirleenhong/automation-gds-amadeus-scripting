!function(t){var e={};function o(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=e,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(r,i,function(e){return t[e]}.bind(null,i));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=2)}([function(t,e){
/*!
 * @license
 * Copyright 2016 - Amadeus Development Company S.A.
 * Copyright of this program is the property of AMADEUS,
 * without whose written permission reproduction in whole
 * or in part is prohibited. All rights reserved.
 * Amadeus S.A. B.P. 69 06902 SOPHIA ANTIPOLIS CEDEX
 * http://www.amadeus.com
 */
var o=function(){};o.prototype.GetPopUpId=smartScriptSession.getPopupId;var r=function(){};function i(){}function n(){this.cmdResponse}function s(){}r.prototype.getParamFromUrl=function(t){return smartScriptSession.qsParams[t]},r.prototype.$waitUntil=function(t,e,o,r){var i=1,n=setInterval(function(){i===o?(r(),clearInterval(n)):"undefined"!=typeof catalog&&(t(),clearInterval(n)),i++},e)},r.prototype.onAbort=function(){console.log("Catalog intial connection as timed out")},i.prototype.SendCryptic=function(t){return new Promise(function(e,o){smartScriptSession.send(t).then(function(t){var o=t;o.Response=t.Response.toString().replace(/\s+$/,""),e(o)},function(t){o(t)})})},i.prototype.SendCrypticWS=function(t){return new Promise(function(e,o){var r=JSON.parse('{"messageAction": {"messageFunctionDetails":{"messageFunction":"M"}},"longTextString":{ "textStringDetails":"'+t+'"}}');smartScriptSession.sendWS("ws.commandCryptic_v7.3.1A",r).then(function(t){var o=t;o.Response=t.Response.toString().replace(/\s+$/,""),e(o)},function(t){o(t)})})},i.prototype.CrypticCallBack=function(t){t.Response=t.Response.toString().replace(/\s+$/,""),this.fulfill(t)},i.prototype.CrypticWSCallBack=function(t){try{t.longTextString.textStringDetails=t.longTextString.textStringDetails.toString().replace(/\s+$/,""),this.fulfill(t)}catch(t){this.reject(t.message)}},n.prototype.GetCrypticResponse=smartScriptSession.getFullCryptic,n.prototype.GetMultiPageResponse=function(t){var e=this;e.cmdResponse=t,(new i).SendCryptic("mdr").then(function(t){e.cmdResponse=e.cmdResponse.replace(/\s+$/,""),e.cmdResponse=e.cmdResponse.substr(0,e.cmdResponse.length-2)+t.Response.toString().replace(/\s+$/,""),")>"===e.cmdResponse.toString().slice(-2)?e.GetMultiPageResponse(e.cmdResponse):e.fulfill(e.cmdResponse)})},s.prototype.Register=function(t){if("userManagement"===t)return smartScriptSession.retrieveUser()},t.exports={PopUp:o,Helper:r,sendCrypticCommand:i,helperCryptic:n,getSellConnectUserInfo:s}},function(t,e){var o;t.exports=smartScriptUtils=((o=function(){this.conf={alphaDictionary:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"}}).prototype.removeDuplicate=function(t){log.debug("smartScriptUtils.removeDuplicate");for(var e=[],o=0;o<t.length;o++)e.indexOf(t[o])<0&&e.push(t[o]);return e},o.prototype.simpleCopy=function(t){var e;if("object"!=typeof t||Array.isArray(t))if(Array.isArray(t)){e=[];for(var o=0;o<t.length;o++)"object"==typeof t[o]?e.push(this.simpleCopy(t[o])):e.push(t[o])}else e=t;else for(var r in e={},t)"object"==typeof t[r]?e[r]=this.simpleCopy(t[r]):e[r]=t[r];return e},o.prototype.overrideProperties=function(t,e,o){log.debug("smartScriptUtils.overrideProperties");var r=void 0!==o&&"boolean"==typeof o.strictType&&o.strictType,i=void 0!==o&&"boolean"==typeof o.inject&&o.inject,n=0;if("object"==typeof e)for(var s in e)(i?!r||void 0===t[s]||typeof e[s]==typeof t[s]:"undefined"!==t[s]&&(!r||typeof e[s]==typeof t[s]))&&("object"!=typeof e[s]||Array.isArray(e[s])?(t[s]=this.simpleCopy(e[s]),n++):(void 0===t[s]&&(t[s]={}),n+=this.overrideProperties(t[s],e[s],o),n++));return n},o.prototype.copyConfiguration=o.prototype.overrideProperties,o.prototype.normalizeCallback=function(t,e){return log.debug("smartScriptUtils.normalizeCallback"),new SmartScriptCallback(t,e)},o.prototype.normalize=function(t){log.debug("smartScriptUtils.normalize");var e=[];return null==t||(Array.isArray(t)?e=t:e.push(t)),e},o.prototype.getParams=function(){log.debug("smartScriptUtils.getParams");for(var t={},e=window.location.search.substring(1).split("&"),o=0;o<e.length;o++){var r=e[o].split("=");if(void 0===t[r[0]])t[r[0]]=decodeURIComponent(r[1]);else if("string"==typeof t[r[0]]){var i=[t[r[0]],decodeURIComponent(r[1])];t[r[0]]=i}else t[r[0]].push(decodeURIComponent(r[1]))}return t},o.prototype.toBoolean=function(t){if(log.debug("smartScriptUtils.toBoolean"),t&&0!==t.length){var e=""+t;t=!("f"===(e=e.toLowerCase())||"0"===e||"false"===e||"no"===e||"n"===e)}else t=!1;return t},o.prototype.padNumber=function(t,e,o){return(String(o||0).repeat(e||2)+String(t)).slice(String(t).length)},o.prototype.getRequest=function(t){log.debug("smartScriptUtils.getRequest");var e=new SmartScriptCallback,o=e.getNewPromise(),r=new XMLHttpRequest;return r.onreadystatechange=function(){4===this.readyState&&(200===this.status?(smartScriptProfiler.end("smartScriptUtils.getRequest call"),e.fulfill(r)):(smartScriptProfiler.end("smartScriptUtils.getRequest call"),e.reject(r)))},r.onerror=function(){smartScriptProfiler.end("smartScriptUtils.getRequest call"),e.reject(r)},r.open("GET",t),smartScriptProfiler.start("smartScriptUtils.getRequest call"),r.send(),o},o.prototype.parseDuration=function(t){log.debug("smartScriptUtils.parseDuration");for(var e=0,o=0,r=/(\d+Y)?(\d+M)?(\d+W)?(\d+D)?(\d+h)?(\d+m)?(\d+s)?/.exec(t),i=1;i<=7;i++)if(void 0!==r[i])switch(e=r[i].slice(0,r[i].length-1),r[i].slice(r[i].length-1)){case"Y":o+=365.25*e*24*60*60*1e3;break;case"M":o+=30*e*24*60*60*1e3;break;case"W":o+=7*e*24*60*60*1e3;break;case"D":o+=24*e*60*60*1e3;break;case"h":o+=60*e*60*1e3;break;case"m":o+=60*e*1e3;break;case"s":o+=1e3*e}return o},o.prototype.readableTime=function(t){log.debug("smartScriptUtils.readableTime");var e=t%1e3,o=Math.floor(t/1e3),r=o%60,i=Math.floor(o/60),n=i%60,s=Math.floor(i/60),a=s%24,c=Math.floor(s/24),p=c%30,l=Math.floor(c/30),u=l%12,d=Math.floor(l/12);return(d>0?d+"Y":"")+(u>0?u+"M":"")+(p>0?p+"D":"")+(a>0?a+"h":"")+(n>0?n+"m":"")+(r>0?r+"s":"")+(e>0?e:"")},o.prototype.numToAlpha=function(t,e){var o=this.conf.alphaDictionary.length,r=void 0!==e?e:"",i=Math.floor(t/o);return i<1?this.conf.alphaDictionary.charAt(t)+r:this.numToAlpha(i,this.conf.alphaDictionary.charAt(t%o)+r)},o.prototype.alphaToNum=function(t,e){var o=this.conf.alphaDictionary.length,r=void 0!==e?e:0,i=this.conf.alphaDictionary.indexOf(t.charAt(0)),n=t.slice(1);return n.length<1?i+r:this.alphaToNum(n,i*Math.pow(o,t.length-1)+r)},o.prototype.compress=function(t,e){var o=smartScriptUtils.simpleCopy({useAlpha:!1});if("object"==typeof e&&smartScriptUtils.overrideProperties(o,e,{strictType:!0}),"string"!=typeof t)return"";for(var r,i,n={},s="",a=[],c=256,p=0;p<c;p++)n[String.fromCharCode(p)]=p;p=0;for(var l=t.length;p<l;p++)i=s+(r=t.charAt(p)),n.hasOwnProperty(i)?s=i:(o.useAlpha?a.push(this.numToAlpha(n[s])):a.push(n[s]),n[i]=c++,s=String(r));return""!==s&&(o.useAlpha?a.push(this.numToAlpha(n[s])):a.push(n[s])),JSON.stringify(a)},o.prototype.decompress=function(t,e){var o=smartScriptUtils.simpleCopy({useAlpha:!1});if("object"==typeof e&&smartScriptUtils.overrideProperties(o,e,{strictType:!0}),"string"!=typeof t)return"";for(var r,i,n,s=JSON.parse(t),a=[],c="",p=256,l=0;l<p;l++)a[l]=String.fromCharCode(l);i=r=o.useAlpha?String.fromCharCode(this.alphaToNum(s[0])):String.fromCharCode(s[0]),l=1;for(var u=s.length;l<u;l++){if(a[n=o.useAlpha?this.alphaToNum(s[l]):s[l]])c=a[n];else{if(n!==p)return null;c=r+r.charAt(0)}i+=c,a[p++]=r+c.charAt(0),r=c}return i},new o)},function(t,e,o){o(3),window.PopUp=o(0).PopUp,window.Helper=o(0).Helper,window.sendCrypticCommand=o(0).sendCrypticCommand,window.helperCryptic=o(0).helperCryptic,window.getSellConnectUserInfo=o(0).getSellConnectUserInfo},function(t,e,o){o(4),o(6),o(7),window.log=o(8);var r=o(9).SmartScriptProfiler;void 0===window.smartScriptSession&&(window.localStorage.removeItem("loglevel"),log.setLevel(log.levels.SILENT,!1),window.smartScriptProfiler=new r),window.SmartScriptCallback=o(10).SmartScriptCallback,o(1),o(11),window.getConfigUtility=window.smartScriptConfigUtility,window.SmartScriptEncodeDecode=o(12).EncodeDecode,window.parseEncDecCommand=window.SmartScriptEncodeDecode,void 0===window.smartScriptSession&&(t.exports=smartScriptSession=function(){var t=function(){log.debug("smartScriptSession.session constructor invocation"),this.scriptSrc="",this.secoUrl="",this.doLoadCatalog=!0,this.conf={debugMode:!1,profileMode:!1,logLevelIfDebug:"TRACE",retryIfThrottled:!0,throttleDelay:1e3,connectionDelay:0,webSdkPlatform:"/",smartToolId:"",platformURL:"",catalogSrc:""},this.CONSTANTS={ptrnSecoURL:/^https:\/\/(([a-zA-Z0-9\-]+\.)*sellingplatformconnect\.amadeus\.(net|com)|www\.topassellconnect\.com)/},this.webSdkPlatform="/",this.qsParams={},this.smartToolId="",this.externalCatalogVersion="",this.LastResponse,this.lasResponse="",this.lastCommand="",this.LastCommand="",this.triggeringCrypticCommand="",this.triggeringQMRule={qmRuleName:"",qmCheckName:""},sessionScope=this,this.__lastCmdCtx={},this.__established=!1,this.__pending_response=!1,this.__pending_delayed_call=!1,this.__throttlingErrors=0,this.lateCallback=0,this.delayedActionsQueue=[],this.eventCallbacks={},this.delayedSetContextParams=[],this.nextSteps=[],this.getConf()};t.prototype.getConf=function(){log.debug("smartScriptSession.getConf"),this.conf.webSdkPlatform=void 0!==window.webSdkPlatform?window.webSdkPlatform:this.conf.webSdkPlatform,"object"==typeof window.smartScriptConfiguration&&smartScriptUtils.overrideProperties(this.conf,window.smartScriptConfiguration),("number"!=typeof this.conf.connectionDelay||this.conf.connectionDelay<0)&&(this.conf.connectionDelay=0),this.webSdkPlatform=this.conf.webSdkPlatform,this.conf.debugMode&&this.enableDebug(),this.conf.profileMode&&this.enableProfile(),smartScriptProfiler.start("from profile activation to established"),this.preInit()},t.prototype.preInit=function(){log.debug("smartScriptSession.preInit"),smartScriptProfiler.start("preInit");this.qsParams=smartScriptUtils.getParams(),this.smartToolId=void 0!==this.qsParams.POPUP_ID?this.qsParams.POPUP_ID:this.smartToolId,this.externalCatalogVersion=void 0!==this.qsParams.EXTERNAL_CATALOG_VERSION?this.qsParams.EXTERNAL_CATALOG_VERSION:this.externalCatalogVersion,this.catalogSrc="",this.platformURL="",smartScriptProfiler.start("testReferrer"),""!==document.referrer&&this.CONSTANTS.ptrnSecoURL.test(document.referrer)&&(this.platformURL=document.referrer,this.catalogSrc="https://"+document.referrer.replace("https://","").split("/")[0]+"/ExternalCatalog.js"),this.postReferrerTest()},t.prototype.postReferrerTest=function(t){log.debug("smartScriptSession.postReferrerTest: ",this.catalogSrc),smartScriptProfiler.end("testReferrer"),""===this.catalogSrc&&"undefined"!=typeof Storage&&(sessionStorage.secoSmartScriptCatalogUrl&&(this.catalogSrc=sessionStorage.secoSmartScriptCatalogUrl),sessionStorage.secoUrl&&(this.platformURL=sessionStorage.secoUrl)),""===this.smartToolId&&"undefined"!=typeof Storage&&sessionStorage.smartToolId&&(this.smartToolId=sessionStorage.smartToolId),""!==this.conf.catalogSrc&&(this.catalogSrc=this.conf.catalogSrc),""!==this.conf.platformURL&&(this.platformURL=this.conf.platformURL,""===this.conf.catalogSrc&&""===this.catalogSrc&&(this.catalogSrc="https://"+this.platformURL.replace("https://","").split("/")[0]+"/ExternalCatalog.js")),""!==this.conf.smartToolId&&(this.smartToolId=this.conf.smartToolId),"undefined"!=typeof Storage&&(sessionStorage.secoSmartScriptCatalogUrl=this.catalogSrc,sessionStorage.secoUrl=this.platformURL,sessionStorage.smartToolId=this.smartToolId),""===this.catalogSrc&&(this.doLoadCatalog=!1),smartScriptProfiler.end("preInit"),this.doLoadCatalog?this.loadCatalog():this.postInit()},t.prototype.loadCatalog=function(){log.debug("smartScriptSession.loadCatalog"),smartScriptProfiler.start("loadCatalog");var t=this,e=document.createElement("script");e.src=this.catalogSrc+"?externalCatalogVersion="+this.externalCatalogVersion,e.onload=function(){smartScriptProfiler.end("loadCatalog"),t.connectToCatalog()},document.getElementsByTagName("head")[0].appendChild(e)},t.prototype.connectToCatalog=function(){log.debug("smartScriptSession.connectToCatalog"),smartScriptProfiler.start("connectToCatalog");var t=this;this.__patchCatalog(),setTimeout(function(){catalog.connect({scope:t,fn:{onSuccess:t.postInit,onError:function(t){log.error("Error : Connection to Smart Script Catalog failed : "+JSON.stringify(t))}}},t.platformURL)},this.conf.connectionDelay)},t.prototype.postInit=function(t){smartScriptProfiler.end("connectToCatalog"),log.debug("smartScriptSession.postInit"),smartScriptProfiler.start("postInit"),this.triggeringCrypticCommand=t.lastCommand?t.lastCommand:this.triggeringCrypticCommand,this.triggeringQMRule=t.qmRule?t.qmRule:this.triggeringQMRule;if(catalog.subscribe("commandpage.notifyResponse",{fn:this.__receivedResponse,scope:this}),void 0!==t&&(this.lastCommand=t.lastCommand,this.LastCommand=t.lastCommand,this.__lastCmdCtx.__fulfill&&this.__lastCmdCtx.__fulfill(this.lastCommand)),!0===this.__pending_response)throw'SmartSession invalid state : can not be "pending response" right now';this.__established=!0,this.processNextAction(),this.processNextStep(),smartScriptProfiler.end("postInit"),smartScriptProfiler.end("from profile activation to established")},t.prototype.processNextStep=function(){this.__established?this.nextSteps.length>0&&(this.nextSteps.shift().fulfill(),this.processNextStep()):log.debug("smartScriptSession.processnextStep :: not established")},t.prototype.then=function(t){var e=new SmartScriptCallback(t);if(this.__established){log.debug("smartscriptSession.then, established");var o=e.getPromise();return e.fulfill(),o}return log.debug("smartScriptSession.then, NOT established"),this.nextSteps.push(e),e.getPromise()},t.prototype.ready=t.prototype.then,t.prototype.do=t.prototype.then,t.prototype.enableDebug=function(t){log.debug("smartScriptSession.enableDebug");var e=void 0!==t?t:this.conf.logLevelIfDebug;this.conf.debugMode=!0,log.setLevel(e)},t.prototype.disableDebug=function(){log.debug("smartScriptSession.disableDebug"),this.conf.debugMode=!1,log.setLevel(log.levels.SILENT)},t.prototype.enableProfile=function(){log.debug("smartScriptSession.enableProfile"),this.conf.profileMode=!0,smartScriptProfiler.activate()},t.prototype.disableProfile=function(){log.debug("smartScriptSession.disableProfile"),this.conf.profileMode=!1,smartScriptProfiler.activate(!1)},t.prototype.fullDebug=function(t){log.debug("smartScriptSession.fullDebug"),"boolean"!=typeof t||t?(this.enableDebug(log.levels.TRACE),this.enableProfile()):(this.disableDebug(),this.disableProfile())},t.prototype.getScriptParameters=function(){return log.debug("smartScriptSession.getScriptParameters"),this.requestService("script.getParameters",null)};var e=function(t){void 0!==t&&(this.Response=t.Response||t.response||t,this.lastCommand=t.Command,self.LastCommand=t.Command,this.ResponseType=t.ResponseType,this.NumberOfLines=t.NbOfLines,this.Lines=[],this.Response&&"string"==typeof this.Response&&(this.Lines=this.Response.trim().split(/\n/)),this.GetLineFromBuffer=function(t){var e="";return t>0&&t<=this.NumberOfLines&&(e=this.Lines[t-1]),e})};t.prototype.__patchCatalog=function(){catalog.dest=this.platformURL},t.prototype.subscribeEvent=function(t){log.debug("smartScriptSession.subscribeEvent");var e=new i(t);return e.callback.fn=this.eventSubscriptionCallback,e.callback.scope=this,e.getPromise(),this.sendOrQueue({type:"subscription",content:e}),e};var o=function(t,e,o){this.inputs=t,this.callback={fn:e},this.promise={fulfill:function(){},reject:function(){}}};o.prototype.getPromise=function(){var t=this;return new Promise(function(e,o){t.promise.fulfill=e,t.promise.reject=o})};var r=function(t,e,o){this.serviceName=t,this.inputs=e,this.callback=new SmartScriptCallback(o),this.promise={fulfill:function(){},reject:function(){}}};r.prototype.getPromise=function(){var t=this;return this.callback.params.action=t,new Promise(function(e,o){t.promise.fulfill=e,t.promise.reject=o})};var i=function(t,e){this.eventName=t,this.subId="",this.new=!0,this.argsToTransmit=[],this.eventCallback=new SmartScriptCallback(e),this.promise={fulfill:function(){},reject:function(){}},this.callback={fn:function(){},scope:smartScriptSession,params:{}}};i.prototype.getPromise=function(){var t=this;return this.callback.params.action=t,new Promise(function(e,o){t.promise.fulfill=e,t.promise.reject=o})},i.prototype.then=function(t){log.debug("setting callback for EventSub"),this.eventCallback.setCallback(t)};var n=function(t,e){this.eventName=t,this.subId=e.subId,this.promise={fulfill:function(){},reject:function(){}},this.callback={fn:function(){},scope:smartScriptSession,params:{}}};return n.prototype.getPromise=function(){var t=this;return this.callback.params.action=t,new Promise(function(e,o){t.promise.fulfill=e,t.promise.reject=o})},t.prototype.triggerEvent=function(t,e){log.debug("smartScriptSession.triggerEvent");for(var o=this.eventCallbacks[e],r=0;r<o.length;r++){var i=smartScriptUtils.normalize(t).concat(o[r].cb.params);o[r].cb.fn.onSuccess.apply(o[r].cb.scope,i)}},t.prototype.eventSubscriptionCallback=function(t,e){log.debug("smartScriptSession.eventSubscriptionCallback");var o=smartScriptSession,r=e.action,i={subscriptionId:0};smartScriptUtils.overrideProperties(i,t,{inject:!0}),"number"==typeof i.response&&i.response>-1?(r.new&&(this.eventCallbacks[r.eventName]=[]),r.subId=Math.floor(9999*Math.random()*(9999*Math.random())),i.subscriptionId=r.subId,this.eventCallbacks[r.eventName].push({id:r.subId,cb:r.eventCallback}),r.promise.fulfill(i)):r.promise.reject(i),o.__pending_response=!1,o.processNextAction()},t.prototype.eventUnsubscriptionCallback=function(t,e){log.debug("smartScriptSession.eventUnsubscriptionCallback");var o=smartScriptSession,r=e.action,i=this.eventCallbacks[r.eventName];if(i){for(var n=0!==r.subId?r.subId:this.eventCallbacks[r.eventName][this.eventCallbacks[r.eventName].length-1].id,s=0;s<i.length;s++)n===i[s].id&&(log.debug("\tsplice !"),i.splice(s,1));r.promise.fulfill(t)}else log.error("unsub error !"),r.promise.reject({data:t,error:"unregistered event"});o.__pending_response=!1,o.processNextAction()},t.prototype.setContextSuccess=function(t){log.debug("smartScriptSession.setContextSuccess");var e=smartScriptSession,o=e.delayedSetContextParams.shift();void 0===t||t.error?o.promise.reject(t):o.promise.fulfill(t),e.__pending_response=!1,e.processNextAction()},t.prototype.setContextError=function(t,e){log.debug("smartScriptSession.setContextError");smartScriptSession;var o=this.delayedSetContextParams.shift();this.__pending_response=!1,o.promise.reject(t),this.processNextAction()},t.prototype.serviceSuccess=function(t,o){log.debug("serviceSuccess");var r=o.action,i=new e(t);this.LastResponse=i,this.lasResponse=this.LastResponse,void 0===i.Response||i.Response.error?r.promise.reject(t):r.promise.fulfill(t),this.__pending_response=!1,this.processNextAction()},t.prototype.serviceError=function(t,e){log.debug("serviceError");var o=e.action;this.__pending_response=!1,(void 0!==t&&t.error&&t.error.msg&&t.error.msg.indexOf("discarded due to over usage")>-1||"string"==typeof t&&t.indexOf("discarded due to over usage")>-1)&&this.conf.retryIfThrottled?(this.delayedActionsQueue.unshift({type:"service",content:o}),this.__pending_delayed_call=!0,this.__throttlingErrors++,setTimeout(this.processNextAction.bind(this),this.conf.throttleDelay)):(o.promise.reject(t),this.processNextAction())},t.prototype.subscribe=function(t,e){log.debug("smartScriptSession.subscribe");var o=new i(t,e);o.callback.fn=this.eventSubscriptionCallback,o.callback.scope=this;var r=o.getPromise();return this.sendOrQueue({type:"subscription",content:o}),r},t.prototype.unsubscribe=function(t,e){log.debug("smartScriptSession.unsubscribe");var o=smartScriptUtils.simpleCopy({subId:0});smartScriptUtils.overrideProperties(o,e,{strictType:!0});var r=new n(t,o);r.callback.fn=this.eventUnsubscriptionCallback,r.callback.scope=this;var i=r.getPromise();return this.sendOrQueue({type:"unsubscription",content:r}),i},t.prototype.processNextAction=function(){log.debug("processNextAction"),this.delayedActionsQueue.length>0&&this.__established&&!1===this.__pending_response&&this.sendImmediate(this.delayedActionsQueue.shift())},t.prototype.requestService=function(t,e){log.debug("requestService");var o=new r(t,e,{fn:{onSuccess:this.serviceSuccess,onError:this.serviceError},scope:this}),i=o.getPromise();return this.sendOrQueue({type:"service",content:o}),i},t.prototype.sendOrQueue=function(t){log.debug("sendOrQueue");this.__established&&!1===this.__pending_response?this.sendImmediate(t):this.delayedActionsQueue.push(t)},t.prototype.sendImmediate=function(t){log.debug("smartScriptSession.sendImmediate");var e=t.content;this.__pending_response=!0,"service"===t.type?(log.debug("\taction type: service ",e),catalog.requestService(e.serviceName,e.inputs,e.callback)):"setContext"===t.type?(log.debug("\taction type: setContext ",e),catalog.setContext(e.inputs.taskId,e.inputs.smartToolId,e.callback)):"subscription"===t.type?(log.debug("\taction type: subscription ",e),this.eventCallbacks[e.eventName]?(e.new=!1,e.callback.fn.apply(this,[{response:0},{action:e}])):catalog.subscribe(e.eventName,{fn:this.triggerEvent,scope:this,params:e.eventName},e.callback)):"unsubscription"===t.type&&(log.debug("\taction type: unsubscription ",e),e.callback.fn.apply(this,[{response:!0},{action:e}]))},t.prototype.sendSpecialKey=function(t){return this.requestService("commandpage.SendSpecialKey",{key:t})},t.prototype.__receivedResponse=function(t){this.LastResponse=new e(t),this.lasResponse=this.LastResponse},t.prototype.isLastUIActive=function(){return!0},t.prototype.sessionName=function(){return""},t.prototype.send=function(t){var e=smartScriptUtils.simpleCopy({command:"",transmit:!0,bypassGraphicHook:!1,bypassSmartTriggerHook:!1});return"string"==typeof t?e.command=t:"object"==typeof t&&smartScriptUtils.overrideProperties(e,t,{strictType:!0}),this.requestService("commandpage.sendCommand",e)},t.prototype.sendMultiLine=function(t){var e=smartScriptUtils.simpleCopy({command:[],transmit:!0,bypassGraphicHook:!1,bypassSmartTriggerHook:!1});return void 0!==t&&Array.isArray(t)?e.command=t:"object"==typeof t&&smartScriptUtils.overrideProperties(e,t,{strictType:!0}),this.requestService("commandpage.sendMultiLineCommand",e)},t.prototype.sendHiddenCommand=function(t){var e=smartScriptUtils.simpleCopy({command:""});return"string"==typeof t?e.command=t:"object"==typeof t&&smartScriptUtils.overrideProperties(e,t,{strictType:!0}),this.requestService("commandpage.sendHiddenCommand",e.command)},t.prototype.refreshBookingFileIfRequired=function(t){log.debug("refreshBookingFileIfRequired - event implementation");var e=this,o="boolean"!=typeof t||t;return new Promise(function(t,r){e.getActiveTask().then(function(r){"PNR"===r.subtype?o?e.subscribe("bookingfile.refreshed",{fn:function(){t()},scope:e}).then(function(){e.refreshBooking()}):(e.refreshBooking(),t()):t()},function(t){r(t)})})},t.prototype.refreshBooking=function(){return this.requestService("bookingfile.refresh",null)},t.prototype.refreshBookingFile=function(){catalog.requestService("bookingfile.refresh")},t.prototype.sendWS=function(t,e){return this.requestService(t,e)},t.prototype.getLastCommand=function(){var t=this;return""!==t.lastCommand?Promise.resolve(t.lastCommand):new Promise(function(e,o){t.__lastCmdCtx.__fulfill=e,t.__lastCmdCtx.__reject=o})},t.prototype.getRecordLocator=function(){return this.requestService("bookingfile.getRecloc",null)},t.prototype.setContext=function(t){log.debug("smartScriptSession.setContext");var e={smartToolId:smartScriptSession.smartToolId,taskId:""},r=smartScriptUtils.simpleCopy(e);"string"==typeof t?r.taskId=t:"object"==typeof t&&smartScriptUtils.overrideProperties(r,t,{strictType:!0});var i=new o(r,this.setContextSuccess),n=i.getPromise();return this.delayedSetContextParams.push(i),this.sendOrQueue({type:"setContext",content:i}),n},t.prototype.getContext=function(){log.debug("smartScriptSession.getContext");var t=this;return this.__established?Promise.resolve(window.catalog.getContext()):this.then(function(){return t.getContext()})},t.prototype.createTask=function(t){var e=smartScriptUtils.simpleCopy({type:"file",subtype:"CMD",name:""});return"object"==typeof t&&smartScriptUtils.overrideProperties(e,t,{strictType:!0}),"INTPARTNER"!==e.subtype&&"SMART_CONTENT"!==e.subtype||""!==e.name?this.requestService("tasks.create",e):Promise.reject('Error : the "name" parameter is mandatory for subtypes "INTPARTNER" and "SMART_CONTENT"')},t.prototype.goToSubTask=function(t){var e=smartScriptUtils.simpleCopy({subtype:"CMD",name:""});return"object"==typeof t&&smartScriptUtils.overrideProperties(e,t,{strictType:!0}),"INTPARTNER"!==e.subtype&&"SMART_CONTENT"!==e.subtype||""!==e.name?this.requestService("tasks.goTo",e):Promise.reject('Error : the "name" parameter is mandatory for subtypes "INTPARTNER" and "SMART_CONTENT"')},t.prototype.getTaskList=function(){return log.debug("smartScriptSession.getTaskList"),this.requestService("tasks.getList",null)},t.prototype.getActiveTask=function(){return log.debug("smartScriptSession.getActiveTask"),this.requestService("tasks.getActive",null)},t.prototype.switchToTask=function(t){var e={smartToolId:this.smartToolId,taskId:"body.main.main"},o=smartScriptUtils.simpleCopy(e);return"object"==typeof t&&smartScriptUtils.overrideProperties(o,t,{strictType:!0}),""===o.taskId?Promise.reject("Error : taskId is mandatory"):this.requestService("popups.switchToTask",[o.smartToolId,o.taskId])},t.prototype.switchOffice=function(t){var e=smartScriptUtils.simpleCopy({destinationOID:"file",subtype:"",contentName:"",launchScript:!1,passRecloc:!1});return"object"==typeof t&&smartScriptUtils.overrideProperties(e,t,{strictType:!0}),"INTPARTNER"===e.subtype||"SMART_CONTENT"===e.subtype&&""===e.contentName?Promise.reject('Error : the "contentName" parameter is mandatory for subtypes "INTPARTNER" and "SMART_CONTENT"'):this.requestService("popups.switchOffice",e)},t.prototype.lightSwitchOffice=function(t){var e=smartScriptUtils.simpleCopy({destinationOID:"file",subtype:"",contentName:"",launchScript:!1});return"object"==typeof t&&smartScriptUtils.overrideProperties(e,t,{strictType:!0}),"INTPARTNER"===e.subtype||"SMART_CONTENT"===e.subtype&&""===e.contentName?Promise.reject('Error : the "contentName" parameter is mandatory for subtypes "INTPARTNER" and "SMART_CONTENT"'):this.requestService("popups.lightSwitchOffice",e)},t.prototype.launchSmartTool=function(t){var e={popupId:smartScriptSession.smartToolId,smartToolName:""},o=smartScriptUtils.simpleCopy(e);return"object"==typeof t&&smartScriptUtils.overrideProperties(o,t,{strictType:!0}),""===o.smartToolName?Promise.reject("Error : smartToolName is a mandatory parameter"):this.requestService("popups.launchSmartTool",o)},t.prototype.showSmartTool=function(t){var e={id:smartScriptSession.smartToolId,giveFocus:!0},o=smartScriptUtils.simpleCopy(e);return"string"==typeof t?o.id=t:"object"==typeof t&&smartScriptUtils.overrideProperties(o,t,{strictType:!0}),this.requestService("popups.show",o)},t.prototype.closeSmartTool=function(t){var e={id:smartScriptSession.smartToolId},o=smartScriptUtils.simpleCopy(e);return"string"==typeof t?o.id=t:"object"==typeof t&&smartScriptUtils.overrideProperties(o,t,{strictType:!0}),this.requestService("popups.close",o)},t.prototype.hideSmartTool=function(t){var e={id:smartScriptSession.smartToolId},o=smartScriptUtils.simpleCopy(e);return"string"==typeof t?o.id=t:"object"==typeof t&&smartScriptUtils.overrideProperties(o,t,{strictType:!0}),this.requestService("popups.hide",o)},t.prototype.resizeSmartTool=function(t){var e={id:smartScriptSession.smartToolId,width:300,height:300},o=smartScriptUtils.simpleCopy(e);return"object"==typeof t&&smartScriptUtils.overrideProperties(o,t,{strictType:!0}),this.requestService("popups.resize",{popupId:o.id,width:o.width,height:o.height})},t.prototype.getFullCryptic=function(t){var e=t.toString().replace(/\s+$/,"");return")>"===e.slice(-2)?new Promise(function(t,o){smartScriptSession.send("mdr").then(function(r){")>"===(e=e.slice(0,-2)+r.Response.toString().replace(/\s+$/,"")).slice(-2)?smartScriptSession.getFullCryptic(e).then(t,o):t(e)})}):Promise.resolve(e)},t.prototype.retrieveUser=function(){return this.requestService("usermanagement.retrieveUser",null)},t.prototype.ShowSmartTool=t.prototype.showSmartTool,t.prototype.CloseWindow=t.prototype.closeSmartTool,t.prototype.HideSmartTool=t.prototype.hideSmartTool,t.prototype.getPopupId=function(){return smartScriptSession.smartToolId},t.prototype.popupResize=function(t,e,o){return this.requestService("popups.resize",{popupId:t,width:e,height:o})},t.prototype.setRiskyAirlines=function(t){var e=t.airlineData?t.airlineData:[];return this.requestService("bookingfile.setRiskyAirlinesList",e)},t.prototype.getLastCrypticCommandAndResponse=function(){return this.requestService("commandpage.getLastCommandAndResponse",null)},t.prototype.getSwitchMode=function(){return this.requestService("popups.getSwitchOfficeMode",{})},t.prototype.populateOnAirPricing=function(t){var e=t.corporateCodes?t.corporateCodes:[];return this.requestService("airPricing.fillPricingOptions",{CorporateCodes:e})},t.prototype.populateOnAllFares=function(t){var e=t.corporateCodes?t.corporateCodes:[];return this.requestService("allFares.fillSearchValues",{CorporateCodes:e})},t.prototype.getTriggeringCrypticCommand=function(){return this.triggeringCrypticCommand},t.prototype.getTriggeringQMRule=function(){return this.triggeringQMRule},new t}())},function(t,e,o){(function(t){var e;!function t(o,r,i){function n(a,c){if(!r[a]){if(!o[a]){if(!c&&("function"==typeof e&&e))return e(a,!0);if(s)return s(a,!0);var p=new Error("Cannot find module '"+a+"'");throw p.code="MODULE_NOT_FOUND",p}var l=r[a]={exports:{}};o[a][0].call(l.exports,function(t){var e=o[a][1][t];return n(e||t)},l,l.exports,t,o,r,i)}return r[a].exports}for(var s="function"==typeof e&&e,a=0;a<i.length;a++)n(i[a]);return n}({1:[function(t,e,o){"use strict";function r(){}function i(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._37=0,this._12=null,this._59=[],t!==r&&l(t,this)}function n(t,e){for(;3===t._37;)t=t._12;return 0===t._37?void t._59.push(e):void u(function(){var o=1===t._37?e.onFulfilled:e.onRejected;if(null!==o){var r=function(t,e){try{return t(e)}catch(t){return d=t,f}}(o,t._12);r===f?a(e.promise,d):s(e.promise,r)}else 1===t._37?s(e.promise,t._12):a(e.promise,t._12)})}function s(t,e){if(e===t)return a(t,new TypeError("A promise cannot be resolved with itself."));if(e&&("object"==typeof e||"function"==typeof e)){var o=function(t){try{return t.then}catch(t){return d=t,f}}(e);if(o===f)return a(t,d);if(o===t.then&&e instanceof i)return t._37=3,t._12=e,void c(t);if("function"==typeof o)return void l(o.bind(e),t)}t._37=1,t._12=e,c(t)}function a(t,e){t._37=2,t._12=e,c(t)}function c(t){for(var e=0;e<t._59.length;e++)n(t,t._59[e]);t._59=null}function p(t,e,o){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=o}function l(t,e){var o=!1,r=function(t,e,o){try{t(e,o)}catch(t){return d=t,f}}(t,function(t){o||(o=!0,s(e,t))},function(t){o||(o=!0,a(e,t))});o||r!==f||(o=!0,a(e,d))}var u=t("asap/raw"),d=null,f={};e.exports=i,i._99=r,i.prototype.then=function(t,e){if(this.constructor!==i)return function(t,e,o){return new t.constructor(function(s,a){var c=new i(r);c.then(s,a),n(t,new p(e,o,c))})}(this,t,e);var o=new i(r);return n(this,new p(t,e,o)),o}},{"asap/raw":4}],2:[function(t,e,o){"use strict";function r(t){var e=new i(i._99);return e._37=1,e._12=t,e}var i=t("./core.js");e.exports=i;var n=r(!0),s=r(!1),a=r(null),c=r(void 0),p=r(0),l=r("");i.resolve=function(t){if(t instanceof i)return t;if(null===t)return a;if(void 0===t)return c;if(!0===t)return n;if(!1===t)return s;if(0===t)return p;if(""===t)return l;if("object"==typeof t||"function"==typeof t)try{var e=t.then;if("function"==typeof e)return new i(e.bind(t))}catch(t){return new i(function(e,o){o(t)})}return r(t)},i.all=function(t){var e=Array.prototype.slice.call(t);return new i(function(t,o){function r(s,a){if(a&&("object"==typeof a||"function"==typeof a)){if(a instanceof i&&a.then===i.prototype.then){for(;3===a._37;)a=a._12;return 1===a._37?r(s,a._12):(2===a._37&&o(a._12),void a.then(function(t){r(s,t)},o))}var c=a.then;if("function"==typeof c)return void new i(c.bind(a)).then(function(t){r(s,t)},o)}e[s]=a,0==--n&&t(e)}if(0===e.length)return t([]);for(var n=e.length,s=0;s<e.length;s++)r(s,e[s])})},i.reject=function(t){return new i(function(e,o){o(t)})},i.race=function(t){return new i(function(e,o){t.forEach(function(t){i.resolve(t).then(e,o)})})},i.prototype.catch=function(t){return this.then(null,t)}},{"./core.js":1}],3:[function(t,e,o){"use strict";function r(t){var e;(e=s.length?s.pop():new i).task=t,n(e)}function i(){this.task=null}var n=t("./raw"),s=[],a=[],c=n.makeRequestCallFromTimer(function(){if(a.length)throw a.shift()});e.exports=r,i.prototype.call=function(){try{this.task.call()}catch(t){r.onerror?r.onerror(t):(a.push(t),c())}finally{this.task=null,s[s.length]=this}}},{"./raw":4}],4:[function(e,o,r){(function(t){"use strict";function e(t){s.length||(n(),!0),s[s.length]=t}function r(){for(;a<s.length;){var t=a;if(a+=1,s[t].call(),a>c){for(var e=0,o=s.length-a;o>e;e++)s[e]=s[e+a];s.length-=a,a=0}}s.length=0,a=0,!1}function i(t){return function(){function e(){clearTimeout(o),clearInterval(r),t()}var o=setTimeout(e,0),r=setInterval(e,50)}}o.exports=e;var n,s=[],a=0,c=1024,p=t.MutationObserver||t.WebKitMutationObserver;n="function"==typeof p?function(t){var e=1,o=new p(t),r=document.createTextNode("");return o.observe(r,{characterData:!0}),function(){e=-e,r.data=e}}(r):i(r),e.requestFlush=n,e.makeRequestCallFromTimer=i}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(t,e,o){"function"!=typeof Promise.prototype.done&&(Promise.prototype.done=function(t,e){(arguments.length?this.then.apply(this,arguments):this).then(null,function(t){setTimeout(function(){throw t},0)})})},{}],6:[function(t,e,o){t("asap"),"undefined"==typeof Promise&&(Promise=t("./lib/core.js"),t("./lib/es6-extensions.js")),t("./polyfill-done.js")},{"./lib/core.js":1,"./lib/es6-extensions.js":2,"./polyfill-done.js":5,asap:3}]},{},[6])}).call(this,o(5))},function(t,e){var o;o=function(){return this}();try{o=o||new Function("return this")()}catch(t){"object"==typeof window&&(o=window)}t.exports=o},function(t,e){String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.substr(e,t.length)===t}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),"function"!=typeof String.prototype.trimLeft&&(String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")}),"function"!=typeof String.prototype.trimRight&&(String.prototype.trimRight=function(){return this.replace(/\s+$/,"")}),String.prototype.repeat||(String.prototype.repeat=function(t){"use strict";if(null==this)throw new TypeError("can't convert "+this+" to object");var e=""+this;if((t=+t)!=t&&(t=0),t<0)throw new RangeError("repeat count must be non-negative");if(t==1/0)throw new RangeError("repeat count must be less than infinity");if(t=Math.floor(t),0==e.length||0==t)return"";if(e.length*t>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var o="",r=0;r<t;r++)o+=e;return o})},function(t,e){String.prototype.rmSpace=function(){return this.replace(/\s+/g,"")}},function(t,e,o){var r,i;/*! loglevel - v1.4.1 - https://github.com/pimterry/loglevel - (c) 2016 Tim Perry - licensed MIT */!function(n,s){"use strict";void 0===(i="function"==typeof(r=function(){function t(t){return typeof console!==a&&(void 0!==console[t]?e(console,t):void 0!==console.log?e(console,"log"):s)}function e(t,e){var o=t[e];if("function"==typeof o.bind)return o.bind(t);try{return Function.prototype.bind.call(o,t)}catch(e){return function(){return Function.prototype.apply.apply(o,[t,arguments])}}}function o(t,e,o){return function(){typeof console!==a&&(r.call(this,e,o),this[t].apply(this,arguments))}}function r(t,e){for(var o=0;o<c.length;o++){var r=c[o];this[r]=t>o?s:this.methodFactory(r,t,e)}}function i(e,r,i){return t(e)||o.apply(this,arguments)}function n(t,e,o){function n(){var t;try{t=window.localStorage[l]}catch(t){}if(typeof t===a)try{var e=window.document.cookie,o=e.indexOf(encodeURIComponent(l)+"=");o&&(t=/^([^;]+)/.exec(e.slice(o))[1])}catch(t){}return void 0===p.levels[t]&&(t=void 0),t}var s,p=this,l="loglevel";t&&(l+=":"+t),p.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},p.methodFactory=o||i,p.getLevel=function(){return s},p.setLevel=function(e,o){if("string"==typeof e&&void 0!==p.levels[e.toUpperCase()]&&(e=p.levels[e.toUpperCase()]),!("number"==typeof e&&e>=0&&e<=p.levels.SILENT))throw"log.setLevel() called with invalid level: "+e;return s=e,!1!==o&&function(t){var e=(c[t]||"silent").toUpperCase();try{return void(window.localStorage[l]=e)}catch(t){}try{window.document.cookie=encodeURIComponent(l)+"="+e+";"}catch(t){}}(e),r.call(p,e,t),typeof console===a&&e<p.levels.SILENT?"No console available for logging":void 0},p.setDefaultLevel=function(t){n()||p.setLevel(t,!1)},p.enableAll=function(t){p.setLevel(p.levels.TRACE,t)},p.disableAll=function(t){p.setLevel(p.levels.SILENT,t)};var u=n();null==u&&(u=null==e?"WARN":e),p.setLevel(u,!1)}var s=function(){},a="undefined",c=["trace","debug","info","warn","error"],p=new n,l={};p.getLogger=function(t){if("string"!=typeof t||""===t)throw new TypeError("You must supply a name when creating a logger.");var e=l[t];return e||(e=l[t]=new n(t,p.getLevel(),p.methodFactory)),e};var u=typeof window!==a?window.log:void 0;return p.noConflict=function(){return typeof window!==a&&window.log===p&&(window.log=u),p},p})?r.call(e,o,e,t):r)||(t.exports=i)}()},function(t,e,o){o(1);var r=function(){this.doProfile=!1,this.profiles={},this.conf={displayStats:!1,outputToConsole:!0}};r.prototype.setConf=function(t){"object"==typeof t&&smartScriptUtils.copyConfiguration(this.conf,t,{strictType:!0})},r.prototype.start=function(t){this.doProfile&&(void 0===this.profiles[t]&&(this.profiles[t]=[]),this.profiles[t].push({start:Date.now(),end:0,duration:0}))},r.prototype.end=function(t){if(this.doProfile)if(void 0===this.profiles[t])this.profiles[t].push({start:0,end:1e5,duration:1e5});else{for(var e=0,o=this.profiles[t].length;e<o&&0!==this.profiles[t][e].end;e++);this.profiles[t][e].end=Date.now()}},r.prototype.display=function(t){if(this.doProfile){var e=smartScriptUtils.simpleCopy(this.conf);"object"==typeof t&&smartScriptUtils.copyConfiguration(e,t,{strictType:!0});var o="-------- PROFILES DISPLAY --------\n";for(method in this.profiles){o+=method+"\tprofile :\n";for(var r=0,i=0,n=0;n<this.profiles[method].length;n++)this.profiles[method][n].duration=this.profiles[method][n].end-this.profiles[method][n].start,o+="\t\t"+method+" duration : "+this.profiles[method][n].duration+"\n",r+=this.profiles[method][n].duration,i+=this.profiles[method][n].duration*this.profiles[method][n].duration;var s=Math.round(r/this.profiles[method].length),a=Math.round(i/this.profiles[method].length)-s*s,c=Math.round(Math.sqrt(a)),p=Math.round(c/s*100),l=[s-c,s+c],u=[s-2*c,s+2*c];o+=this.profiles[method].length>1?"\t\t"+method+" average duration ("+this.profiles[method].length+" executions) : "+s+" miliseconds\n":"",o+=e.displayStats&&this.profiles[method].length>2?"\t\t"+method+" duration standard deviation ("+this.profiles[method].length+" executions) : "+c+" miliseconds ("+p+"%)\n":"",o+=e.displayStats&&this.profiles[method].length>2?"\t\t"+method+" duration 68% confidence interval  ("+this.profiles[method].length+" executions) : "+l[0]+" to "+l[1]+" miliseconds\n":"",o+=e.displayStats&&this.profiles[method].length>2?"\t\t"+method+" duration 95% confidence interval  ("+this.profiles[method].length+" executions) : "+u[0]+" to "+u[1]+" miliseconds\n":"",o+="\n"}return e.outputToConsole&&console.info(o),o}},r.prototype.clear=function(){this.doProfile&&(this.profiles={})},r.prototype.activate=function(t){return log.debug("smartScriptProfiler.activate"),this.doProfile="boolean"!=typeof t||t,this.doProfile},t.exports={SmartScriptProfiler:r}},function(t,e){var o=function(t,e){this.fn={onSuccess:function(){},onError:function(){}},this.scope=window,this.params=[],this.setCallback(t,e),this.fulfill=function(){},this.reject=function(){}};o.prototype.setCallback=function(t,e){void 0!==e&&(this.fn.onSuccess=e.fn.onSuccess,this.fn.onError=e.fn.onError,this.scope=e.scope,this.params=smartScriptUtils.normalize(e.params)),"function"==typeof t?this.fn.onSuccess=t:"object"==typeof t&&("function"==typeof t.fn?this.fn.onSuccess=t.fn:"object"==typeof t.fn&&("function"==typeof t.fn.onSuccess&&(this.fn.onSuccess=t.fn.onSuccess),"function"==typeof t.fn.onError&&(this.fn.onError=t.fn.onError)),"object"==typeof t.scope&&(this.scope=t.scope),void 0!==t.params&&(this.params=smartScriptUtils.normalize(t.params)))},o.prototype.getNewPromise=function(){var t=this;return new Promise(function(e,o){t.fulfill=e,t.reject=o})},o.prototype.getPromise=function(){var t=this;return new Promise(function(e,o){t.fulfill=function(){var o=t.fn.onSuccess.apply(t.scope,t.params);"object"==typeof o&&"function"==typeof o.then?o.then(function(t){e(t)}):e(o)},t.reject=function(){var e=t.fn.onError.apply(t.scope,t.params);"object"==typeof e&&"function"==typeof e.then?e.then(function(t){o(t)}):o(e)}})},t.exports={SmartScriptCallback:o}},function(t,e){void 0===window.smartScriptConfigUtility&&(t.exports=smartScriptConfigUtility=function(){var t=function(){this.conf={baseConfigPath:"../config/",pathURL:"/services/sptool/scriptapi/v1/scripts/[SCRIPT_ID]?V=[VERSION_NUMBER]&OID=[OFFICE_ID]&UID=[USER_ID]",uatDomain:"https://uat.customsolutions.amadeus.com",prdDomain:"https://customsolutions.amadeus.com",prdSECODomainRegex:/https:\/\/www(\.([a-zA-Z]{2}\d{1}|custom))?\.sellingplatformconnect\.amadeus\.com/}};function e(t){return"object"==typeof t.response&&null!==t.response?t.response:{message:t.response||t.statusText||"Error while retrieving configuration"}}function o(t){return response=t.response.slice(t.response.indexOf("{"),t.response.lastIndexOf("}")+1),JSON.parse(response)}return t.prototype.setConfPath=function(t){this.conf.baseConfigPath=String(t)},t.prototype.getFileName=function(t,e,o,r){var i="";return i+=t||"",i+=e?"_"+e:"",i+=o?"_"+o:"",(i+=r?"_"+r:"")+".js?timestamp="+Date.now()},t.prototype.getConfig=function(t,r,i,n){log.debug("smartScriptConfigUtility.getFileConfig");var s=this.conf.baseConfigPath,a=this,c=new SmartScriptCallback,p=c.getNewPromise();return void 0!==t&&void 0!==r?smartScriptUtils.getRequest(s+a.getFileName(t,r,i,n)).then(function(t){try{var r=o(t);c.fulfill(r)}catch(t){log.error(t),c.reject(e(t))}},function(){smartScriptUtils.getRequest(s+a.getFileName(t,r,i)).then(function(t){try{var r=o(t);c.fulfill(r)}catch(t){log.error(t),c.reject(e(t))}},function(){smartScriptUtils.getRequest(s+a.getFileName(t,r)).then(function(t){try{var r=o(t);c.fulfill(r)}catch(t){log.error(t),c.reject(e(t))}},function(t){c.reject(e(t))})})}):c.reject({message:"Invalid Script ID or Version Number"}),p},new t}())},function(t,e,o){window.LRUCache=o(13).LRUCache,o(1);var r=function(){this.initialized=!1,this.commands={decode:{airport:"DAN",city:"DAC",nationality:"DC",state:"DNS",airline:"DNA",boardingPoint:"DB",aircraftType:"DNE",hotelChain:"DNH",carCompany:"DNC",hotelRate:"DNN",tourOrRail:"DNP",statesOrProvinces:"DNS",connectPoint:"DXS",specialCarEquip:"CE"},encode:{state:"DNS",airline:"DNA",airCraft:"DNE",hotel:"DNH",car:"DNC",hotelRate:"DNN",tourOrRail:"DNP",city:"DAN"}},this.conf={encodeDecode:{encodeOrDecode:"decode",typeToCode:"city",sendHidden:!0},cache:"persistent",name:"smartScriptCodeCache",cacheSizeLimit:200,cacheDataReadableTTL:"6M",cacheDataTTL:0,useCacheCompression:!0},this.codeCache,this.getters={DEFAULT:{encodeOrDecode:"decode",typeToCode:"city",sendHidden:!0,return:"all",data:{},asMap:!0},CountryStateCode:{encodeOrDecode:"decode",typeToCode:"city",sendHidden:!0,return:"countryStateCode",data:{cityName:s,cityCode:a,countryCode:n,countryStateCode:i,countryName:c},asMap:!1},CountryCode:{encodeOrDecode:"decode",typeToCode:"city",sendHidden:!0,return:"countryCode",data:{cityName:s,cityCode:a,countryCode:n,countryStateCode:i,countryName:c},asMap:!1},CityName:{encodeOrDecode:"decode",typeToCode:"city",sendHidden:!0,return:"cityName",data:{cityName:s,cityCode:a,countryCode:n,countryStateCode:i,countryName:c},asMap:!1},CityCode:{encodeOrDecode:"decode",typeToCode:"city",sendHidden:!0,return:"cityCode",data:{cityName:s,cityCode:a,countryCode:n,countryStateCode:i,countryName:c},asMap:!1},CountryName:{encodeOrDecode:"decode",typeToCode:"city",sendHidden:!0,return:"countryName",data:{cityName:s,cityCode:a,countryCode:n,countryStateCode:i,countryName:c},asMap:!1},DACData:{encodeOrDecode:"decode",typeToCode:"city",sendHidden:!0,return:"all",data:{cityName:s,cityCode:a,countryCode:n,countryStateCode:i,countryName:c,airportList:p,railStationList:l},asMap:!0},DNAData:{encodeOrDecode:"decode",typeToCode:"airline",sendHidden:!0,return:"all",data:{airlineCode:u,airlineName:d,IATANumber:f},asMap:!0}}};function i(t){return r.prototype.parseForSingleValueRE(t,/CITY :[^\n]*\n[^\/]*\/([A-Z]{2}[A-Z]{0,2}):.*/m)}function n(t){return r.prototype.parseForSingleValueRE(t,/CITY :[^\n]*\n[^\/]*\/([A-Z]{2})[A-Z]{0,2}:.*/m)}function s(t){return r.prototype.parseForSingleValueRE(t,/CITY :[^\n]*\n\s*[A-Z]{3}[\s*]+C\s+([A-Z]+(?:\s+[A-Z]+)*)\s+[^\/]*\/[A-Z]{2}[A-Z]{0,2}:.*/m)}function a(t){return r.prototype.parseForSingleValueRE(t,/CITY :[^\n]*\n\s*([A-Z]{3})[\s*]+C\s+/m)}function c(t){return r.prototype.parseForSingleValueRE(t,/CITY :[^\n]*\n[^\/]*\/[A-Z]{2}[A-Z]{0,2}:(.*?)\s*\n/)}function p(t){return r.prototype.parseForListPairValuesRE(t,/\s*([A-Za-z0-9]{3})[* ]+A\s+([A-Za-z0-9\- ]*?)\s*\//)}function l(t){return r.prototype.parseForListPairValuesRE(t,/\s*([A-Za-z0-9]{3})[* ]+R\s+([A-Za-z0-9\- ]*?)\s*\//)}function u(t){return r.prototype.parseForSingleValueRE(t,/([A-Za-z0-9]{2})\/[A-Za-z0-9]{2,3}\s+\d+\s+[a-zA-Z0-9\s]+?\s*$/m)}function d(t){return r.prototype.parseForSingleValueRE(t,/[A-Za-z0-9]{2}\/[A-Za-z0-9]{2,3}\s+\d+\s+([a-zA-Z0-9\s]+?)\s*$/m)}function f(t){return r.prototype.parseForSingleValueRE(t,/[A-Z0-9]{2}\/[A-Z0-9]{2,3}\s+(\d+)\s+[a-zA-Z0-9\s]+?\s*$/m)}r.prototype.init=function(t){log.debug("SmartScriptEncodeDecode.init");var e;if((this.initialized=!0,this.conf.cacheDataTTL=smartScriptUtils.parseDuration(this.conf.cacheDataReadableTTL),"number"==typeof t&&(this.conf.cacheSizeLimit=t),"persistent"===this.conf.cache||"session"===this.conf.cache)&&(this.codeCache=new LRUCache(this.conf.cacheSizeLimit),null!==(e="persistent"===this.conf.cache?window.localStorage.getItem(this.conf.name):window.sessionStorage.getItem(this.conf.name))&&"null"!==e)){log.debug("raw cache length at retrieval : "+e.length);for(var o=this.conf.useCacheCompression?smartScriptUtils.decompress(e):e,r=JSON.parse(o),i=0;i<r.length;i++)this.codeCache.put(r[i].key,r[i].value)}},r.prototype.reInit=function(){return log.debug("EncodeDecode.reInit, already initialized ? "+this.initialized),!this.initialized&&(this.init(),!0)},r.prototype.clearCache=function(){this.reInit(),window.localStorage.setItem(this.conf.name,null),this.codeCache=new LRUCache(this.conf.cacheSizeLimit)},r.prototype.displayCache=function(t){this.reInit();for(var e=void 0!==t&&void 0!==t.dataAge&&t.dataAge,o="object"==typeof this.codeCache?JSON.parse(JSON.stringify(this.codeCache)):[],r="cache Content : {",i=0;i<o.length;i++)if(void 0!==o[i].key){for(var n in r+="\n\t'"+o[i].key+"'",r+=e?" (data age : "+smartScriptUtils.readableTime((new Date).valueOf()-o[i].value.rTime)+")":"",r+=" : {",o[i].value.result)if(Array.isArray(o[i].value.result[n])){r+="\n\t\t'"+n+"' : [";for(var s=0;s<o[i].value.result[n].length;s++)r+="\n\t\t\t"+JSON.stringify(o[i].value.result[n][s])+",";"["!==r.charAt(r.length-1)&&(r=r.slice(0,-1)),r+="\n\t\t],"}else r+="\n\t\t'"+n+"' : "+JSON.stringify(o[i].value.result[n])+",";r=r.slice(0,-1),r+="\n\t},"}return r=r.slice(0,-1),r+="\n}"},r.prototype.displayNativeCache=function(){return this.initialized?JSON.stringify(this.codeCache):"decoder not yet initialized, cache cannot be displayed"},r.prototype.setConfiguration=function(t){smartScriptUtils.overrideProperties(this.conf,t,{strictType:!0})},r.prototype.setGetter=function(t,e){var o=smartScriptUtils.simpleCopy({encodeOrDecode:"decode",typeToCode:"city",sendHidden:!0,return:"all",data:{},asMap:!0});smartScriptUtils.overrideProperties(o,e,{strictType:!0}),smartScriptUtils.overrideProperties(o.data,e.data,{inject:!0}),this.getters[t]=o},r.prototype.setScriptName=function(t){return"string"==typeof t&&(this.conf.name=t,!0)},r.prototype.setCacheTTL=function(t){this.conf.cacheDataReadableTTL=t,this.conf.cacheDataTTL=smartScriptUtils.parseDuration(t)},r.prototype.get=function(t,e){log.debug("EncodeDecode.get"),smartScriptProfiler.start("EncodeDecode.get");var o=this,r=!0;this.reInit();var i,n=smartScriptUtils.simpleCopy(o.getters.DEFAULT);"string"==typeof e&&void 0!==o.getters[e]?smartScriptUtils.overrideProperties(n,o.getters[e],{strictType:!0,inject:!0}):"object"==typeof e?smartScriptUtils.overrideProperties(n,e,{strictType:!0,inject:!0}):smartScriptUtils.overrideProperties(n,o.getters.DACData,{strictType:!0,inject:!0});var s=o.commands[n.encodeOrDecode][n.typeToCode]+t;if("persistent"!==o.conf.cache&&"session"!==o.conf.cache||void 0===o.codeCache.get(s))r=!0;else{var a=o.codeCache.get(s);if(r=!1,"all"!==n.return&&void 0===a.result[n.return])r=!0;else for(var c in n.data)if(void 0===a.result[c]){r=!0;break}var p=(new Date).valueOf();!r&&a.rTime+o.conf.cacheDataTTL<p&&(o.codeCache.remove(s),r=!0)}return r?i=o.send(t,{encodeOrDecode:n.encodeOrDecode,typeToCode:n.typeToCode,sendHidden:n.sendHidden}).then(function(t){var e=o.getSructuredDataFromResponse(t,n.data),r="";return"persistent"!==o.conf.cache&&"session"!==o.conf.cache||(o.codeCache.put(s,{result:e,rTime:(new Date).valueOf()}),r=o.conf.useCacheCompression?smartScriptUtils.compress(JSON.stringify(o.codeCache)):JSON.stringify(o.codeCache)),log.debug("updating cache, length : "+r.length),"persistent"===o.conf.cache?window.localStorage.setItem(o.conf.name,r):"session"===o.conf.cache&&window.sessionStorage.setItem(o.conf.name,r),smartScriptProfiler.end("EncodeDecode.get"),"all"!==n.return&&void 0!==e[n.return]?Promise.resolve(e[n.return]):Promise.resolve(e)},function(t){log.error("error in send (encode/decode request) : "+JSON.stringify(t))}):(i="all"!==n.return?Promise.resolve(a.result[n.return]):Promise.resolve(a.result),smartScriptProfiler.end("EncodeDecode.get")),i},r.prototype.getList=function(t,e){log.debug("getList : listToCode : "+JSON.stringify(t)+", options : "+JSON.stringify(e));var o=this,r=smartScriptUtils.simpleCopy(this.getters.DEFAULT);return"string"==typeof e&&void 0!==this.getters[e]?smartScriptUtils.overrideProperties(r,this.getters[e],{strictType:!0,inject:!0}):"object"==typeof e?smartScriptUtils.overrideProperties(r,e,{strictType:!0,inject:!0}):smartScriptUtils.overrideProperties(r,this.getters.DACData,{strictType:!0,inject:!0}),this.reInit(),function t(e,i,n){var s;s=r.asMap?void 0!==n?n:{}:void 0!==n?n:[];var a=void 0!==i?i:0;return a===e.length?Promise.resolve(s):o.get(e[a],r).then(function(o){return r.asMap?s[e[a]]=o:s.push(o),t(e,a+1,s)})}(t)},r.prototype.getListAsMap=function(t,e){var o=smartScriptUtils.simpleCopy(this.getters.DEFAULT);return"string"==typeof e&&void 0!==this.getters[e]?smartScriptUtils.overrideProperties(o,this.getters[e],{strictType:!0,inject:!0}):"object"==typeof e?smartScriptUtils.overrideProperties(o,e,{strictType:!0,inject:!0}):smartScriptUtils.overrideProperties(o,this.getters.DACData,{strictType:!0,inject:!0}),o.asMap=!0,this.getList(smartScriptUtils.removeDuplicate(t),o)},r.prototype.getListAsList=function(t,e){var o=smartScriptUtils.simpleCopy(this.getters.DEFAULT);return"string"==typeof e&&void 0!==this.getters[e]?smartScriptUtils.overrideProperties(o,this.getters[e],{strictType:!0,inject:!0}):"object"==typeof e?smartScriptUtils.overrideProperties(o,e,{strictType:!0,inject:!0}):smartScriptUtils.overrideProperties(o,this.getters.DACData,{strictType:!0,inject:!0}),o.asMap=!1,this.getList(t,o)},r.prototype.sendEncodeDecode=function(t,e,o){return this.send(e,{encodeOrDecode:t,typeToCode:o,sendHidden:!1})},r.prototype.send=function(t,e){log.debug("EncodeDecode.send, strToCode : "+t+", options : "+JSON.stringify(e)),smartScriptProfiler.start("EncodeDecode.send");var o=smartScriptUtils.simpleCopy(this.conf.encodeDecode);smartScriptUtils.overrideProperties(o,e,{strictType:!0});this.reInit();var r=this.commands[o.encodeOrDecode][o.typeToCode]+" "+t;return new Promise(function(t,e){o.sendHidden?smartScriptSession.sendHiddenCommand(r).then(function(e){smartScriptProfiler.end("EncodeDecode.send"),t(e)},function(t){smartScriptProfiler.end("EncodeDecode.send"),e(t)}):smartScriptSession.send(r).then(function(e){smartScriptProfiler.end("EncodeDecode.send"),t(e)},function(t){smartScriptProfiler.end("EncodeDecode.send"),e(t)})})},r.prototype.getSructuredDataFromResponse=function(t,e){var o="string"==typeof t.Response?t.Response:t,r={};for(var i in e)r[i]=e[i](o);return r},r.prototype.parseForSingleValueRE=function(t,e){var o="string"==typeof t.Response?t.Response:t,r=e.exec(o);return null!==r&&void 0!==r[1]?r[1]:""},r.prototype.parseForListPairValuesRE=function(t,e){for(var o=[],r=("string"==typeof t.Response?t.Response:t).split(/\n/),i=0;i<r.length;i++){var n=e.exec(r[i]);null!==n&&void 0!==n[1]&&void 0!==n[2]&&o.push({code:n[1],name:n[2]})}return o},t.exports={EncodeDecode:r}},function(t,e){
/**
* @license
* Licensed under MIT. Copyright (c) 2010 Rasmus Andersson <http://hunch.se/>
* See README.md for details.
*/
function o(t){this.size=0,this.limit=t,this.oldest=this.newest=void 0,this._keymap={}}o.prototype._markEntryAsUsed=function(t){t!==this.newest&&(t.newer&&(t===this.oldest&&(this.oldest=t.newer),t.newer.older=t.older),t.older&&(t.older.newer=t.newer),t.newer=void 0,t.older=this.newest,this.newest&&(this.newest.newer=t),this.newest=t)},o.prototype.put=function(t,e){var o=this._keymap[t];return o?(o.value=e,void this._markEntryAsUsed(o)):(this._keymap[t]=o={key:t,value:e,older:void 0,newer:void 0},this.newest?(this.newest.newer=o,o.older=this.newest):this.oldest=o,this.newest=o,this.size++,this.size>this.limit?this.shift():void 0)},o.prototype.shift=function(){var t=this.oldest;return t&&(this.oldest.newer?(this.oldest=this.oldest.newer,this.oldest.older=void 0):(this.oldest=void 0,this.newest=void 0),t.newer=t.older=void 0,delete this._keymap[t.key],this.size--),t},o.prototype.get=function(t,e){var o=this._keymap[t];if(void 0!==o)return this._markEntryAsUsed(o),e?o:o.value},o.prototype.find=function(t){return this._keymap[t]},o.prototype.set=function(t,e){var o,r=this.get(t,!0);return r?(o=r.value,r.value=e):(o=this.put(t,e))&&(o=o.value),o},o.prototype.remove=function(t){var e=this._keymap[t];if(e)return delete this._keymap[e.key],e.newer&&e.older?(e.older.newer=e.newer,e.newer.older=e.older):e.newer?(e.newer.older=void 0,this.oldest=e.newer):e.older?(e.older.newer=void 0,this.newest=e.older):this.oldest=this.newest=void 0,this.size--,e.value},o.prototype.removeAll=function(){this.oldest=this.newest=void 0,this.size=0,this._keymap={}},"function"==typeof Object.keys?o.prototype.keys=function(){return Object.keys(this._keymap)}:o.prototype.keys=function(){var t=[];for(var e in this._keymap)t.push(e);return t},o.prototype.forEach=function(t,e,o){var r;if(!0===e?(o=!0,e=void 0):"object"!=typeof e&&(e=this),o)for(r=this.newest;r;)t.call(e,r.key,r.value,this),r=r.older;else for(r=this.oldest;r;)t.call(e,r.key,r.value,this),r=r.newer},o.prototype.toJSON=function(){for(var t=new Array(this.size),e=0,o=this.oldest;o;)t[e++]={key:o.key,value:o.value},o=o.newer;return t},o.prototype.toString=function(){for(var t="",e=this.oldest;e;)t+=String(e.key)+":"+e.value,(e=e.newer)&&(t+=" < ");return t},"object"==typeof this&&(this.LRUCache=o),t.exports={LRUCache:o}}]);
